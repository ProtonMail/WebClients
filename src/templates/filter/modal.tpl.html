<dialog
    class="filter-modal-container"
    ng-class="ctrl.mode === 'complex' ? 'filter-modal-complex' : 'filter-modal-simple'">

    <header class="pm-modalHeader">
        <button
            type="button"
            class="pm-modalClose"
            ng-click="ctrl.cancel()"
            title-translate="Close"
            title-translate-context="Action">Ã—</button>
        <h1
            id="modalTitle"
            class="pm-modalTitle"
            translate-context="Filter modal title"
            translate>Custom Filter</h1>
    </header>

    <form
        class="pm-modalContent"
        name="addFilterModal"
        ng-click="ctrl.resetValidity()"
        autocomplete="off"
        ng-submit="ctrl.save()"
        novalidate>

        <div class="pm-modalContentInner">

            <div class="AddFilterModal-editor">
                <div class="flex flex-nowrap onmobile-flex-column mb1">
                    <label
                        for="filterName"
                        translate
                        translate-context="Title"
                        class="pm-label">Name</label>

                    <div class="w100">
                        <input
                            class="pm-field w100"
                            id="filterName"
                            name="filterName"
                            ng-model="ctrl.filter.Name"
                            required
                            autocomplete="off">

                        <div
                            class="error-zone"
                            ng-messages="addFilterModal.filterName.$error"
                            ng-show="addFilterModal.filterName.$dirty || addFilterModal.$submitted">
                            <p
                                ng-message="required"
                                class="m0 color-global-warning"
                                translate-context="Error"
                                translate>Field required</p>
                        </div>
                    </div>
                </div>

                <div class="flex flex-nowrap onmobile-flex-column mb1">
                    <label
                        for="logic"
                        class="pm-label"
                        translate
                        translate-context="Title">Logic</label>
                    <div class="w100">
                        <select
                            size="1"
                            class="pm-field w100"
                            name="logic"
                            ng-model="ctrl.filter.Simple.Operator"
                            ng-options="operator.label for operator in ctrl.operators"></select>
                    </div>
                </div>

                <div
                    ng-repeat="condition in ctrl.filter.Simple.Conditions track by $id(condition)"
                    ng-class="{
                        'filterModal-error-condition': !ctrl.validator.conditions.errors[$index].isValid
                    }"
                    class="flex flex-nowrap onmobile-flex-column mb1">

                    <div class="pm-label pt0 mb0-5">
                        <span translate translate-context="Title">Conditions</span>
                        <span class="mr1">{{$index + 1}}</span>
                        <button
                            ng-click="ctrl.removeCondition(condition)"
                            class="pm-button pm-button--for-icon "
                            type="button">
                            <icon data-name="trash"></icon>
                            <span class="sr-only" translate-context="action"
                            translate>Delete</span>
                        </button>
                    </div>

                    <div class="w100">
                        <select
                            size="1"
                            class="pm-field w100"
                            name="conditionType"
                            ng-model="condition.Type"
                            ng-class="{
                                'filterModal-error-condition-': !ctrl.validator.conditions.errors[$index].isValid
                            }"
                            aria-invalid="{{ctrl.validator.conditions.errors[$index].errors.includes('type')}}"
                            ng-options="type.label for type in ctrl.types track by type.value"></select>

                        <div
                            class="error-zone"
                            ng-show="ctrl.validator.conditions.errors[$index].errors.includes('type') && addFilterModal.$submitted">
                            <p
                                class="m0 color-global-warning"
                                translate-context="Error"
                                translate>You must choose a type of condition</p>
                        </div>


                        <div
                            class="filterModal-condition-attachments mt1 mb1"
                            ng-if="condition.Type.value === 'attachments'">
                                <label class="pm-label inline-flex">
                                    <custom-radio
                                        data-custom-ng-change="ctrl.onChangeAttachements(condition, 'contains')"
                                        data-custom-ng-model="condition.Comparator.value"
                                        data-custom-ng-value="'contains'"
                                        data-custom-value="contains"></custom-radio>
                                    <span translate translate-context="Title">With Attachments</span>
                                </label>

                                <label class="pm-label inline-flex">
                                    <custom-radio
                                        data-custom-ng-change="ctrl.onChangeAttachements(condition, '!contains')"
                                        data-custom-ng-model="condition.Comparator.value"
                                        data-custom-ng-value="'!contains'"
                                        data-custom-value="!contains"></custom-radio>
                                    <span translate translate-context="Title">Without Attachments</span>
                                </label>
                        </div>

                        <select
                            size="1"
                            class="pm-field w100 mt1"
                            name="filterConditions"
                            ng-model="condition.Comparator"
                            ng-if="condition.Type.value  !== 'attachments'"aria-invalid="{{ctrl.validator.conditions.errors[$index].errors.includes('comparator')}}"
                            ng-options="comparator.label for comparator in ctrl.comparators track by comparator.value"></select>

                        <div
                             ng-if="condition.Type.value !== 'attachments'"
                            class="flex flex-column w100 mb1 mt1">

                            <div
                                class="flex flex-nowrap mb1 EditConditionValue-container mb0-5"
                                ng-if="condition.Values.length"
                                ng-repeat="value in condition.Values track by value"
                                data-info="Or">
                                <input
                                    class="pm-field w80"
                                    type="text"
                                    autocomplete="off"
                                    ng-value="value">

                                <button
                                    role="button"
                                    class="pm-button ml1"
                                    type="button"
                                    ng-click="condition.Values.splice($index, 1)"
                                    translate
                                    translate-context="Action">Delete</button>
                            </div>

                            <div class="flex flex-nowrap ">
                                <input
                                    class="pm-field w80"
                                    id="textOrPattern"
                                    placeholder-translate="Text or pattern"
                                    placeholder-translate-context="Filter modal condition"
                                    type="text"
                                    ng-model="condition.value"
                                    aria-invalid="{{ctrl.validator.conditions.errors[$index].errors.includes('value')}}"
                                    ng-keypress="$event.keyCode === 13 && ctrl.addValue(condition, $event)"
                                    ng-blur="ctrl.addValue(condition)"
                                    autocomplete="off">
                                <button
                                    role="button"
                                    ng-disabled="!condition.value"
                                    class="pm-button pm-button--for-icon inline-flex ml1"
                                    type="button"
                                    pt-tooltip-translate="Add"
                                    pt-tooltip-translate-context="Action"
                                    ng-hide="ctrl.filter.Simple.Conditions.length === 1"
                                    ng-click="ctrl.removeCondition(condition)"
                                    class="pm_button white">
                                    <icon data-name="add" class="mauto"></icon>
                                    <span class="sr-only" translate-context="action" translate>Add</span>
                                </button>
                            </div>

                            <div
                                class="error-zone"
                                ng-show="ctrl.validator.conditions.errors[$index].errors.includes('value') && addFilterModal.$submitted">
                                <p
                                    class="m0 color-global-warning"
                                    translate-context="Error"
                                    translate>You must set a value</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-nowrap onmobile-flex-column mb2">
                    <span class="pm-label pt0"></span>
                    <div class="w100">
                        <button
                            role="button"
                            class="pm-button pm-button--primary"
                            type="button"
                            ng-click="ctrl.addCondition()"
                            translate
                            translate-context="Action">Add a new condition</button>
                    </div>
                </div>

                <div
                    ng-class="{
                        'filterModal-error-actions-': !ctrl.validator.actions.isValid
                    }"
                    class="flex flex-nowrap onmobile-flex-column mb1 mt1">
                    <label
                        for="actions"
                        class="pm-label"
                        translate-context="Title"
                        translate>Actions</label>

                    <div class="w100">
                        <div class="mb1">
                            <autocomplete-labels></autocomplete-labels>

                            <ul className="m0 mt1 mb1 p0 unstyled" ng-if="ctrl.selectedLabels.length">
                                <li
                                    class="flex filterModal-item-label"
                                    ng-repeat="label in ctrl.selectedLabels track by label.ID">
                                    <icon data-name="label" ng-style="{ fill: label.Color }" class="mr1"></icon>
                                    <span class="ellipsis w70">{{::label.Name }}</span>
                                    <button
                                        type="button"
                                        ng-click="ctrl.removeLabel($index, label)"
                                        class="pm-button--small mlauto"
                                        translate-context="Action"
                                        translate>Remove</button>
                                </li>
                            </ul>
                        </div>

                        <div class="flex flex-nowrap onmobile-flex-column mb1">
                            <select
                                size="1"
                                class="pm-field w100 mlauto"
                                name="folderDest"
                                ng-model="ctrl.filter.Simple.Actions.Move"
                                ng-options="folder.value as folder.label for folder in ctrl.folders track by folder.value"></select>
                        </div>

                        <div class="flex flex-nowrap onmobile-flex-column mb1">
                            <select
                                size="1"
                                class="pm-field w100 mlauto"
                                name="markAs"
                                ng-model="ctrl.markAsValue"
                                ng-options="mark.value as mark.label for mark in ctrl.markAs track by mark.value"></select>
                        </div>

                        <div
                            ng-if="::ctrl.isPaid"
                            class="mb1">

                            <div class="mb1">
                                <toggle
                                    data-id="toggleVacation"
                                    data-status="ctrl.hasVacation"></toggle>
                                <label
                                    for="toggleVacation"
                                    class="ml1"
                                    translate-context="Filter modal label"
                                    translate>Send auto reply</label>
                            </div>

                            <div
                                class="bordered"
                                ng-if="ctrl.hasVacation">
                                <squire
                                    id="vacationMessage"
                                    class="no-resize error_tooltip"
                                    allow-data-uri="true"
                                    data-value="ctrl.filter.Simple.Actions.Vacation"
                                    data-type-content="OOF-Message"></squire>
                            </div>

                        </div>

                        <div
                            class="color-global-warning error-zone"
                            ng-if="ctrl.validator.actions.isValid === false && addFilterModal.$submitted"
                            id="ActionsError"
                            translate-context="Error"
                            translate>A filter must have an action</div>
                    </div>
                </div>
            </div>

        </div>

        <footer class="pm-modalFooter flex flex-spacebetween">
            <button
                type="button"
                class="pm-button-blueborder disabled-if-network-activity"
                ng-click="ctrl.cancel()"
                translate
                translate-context="Action">Cancel</button>
            <button
                class="pm-button-blue disabled-if-network-activity"
                translate
                translate-context="Action">Save</button>
        </footer>
    </form>

</dialog>
