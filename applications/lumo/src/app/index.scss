@use './assets/fonts/fonts.css' as *;
@use '~@proton/styles/scss/proton-lumo' as *;

@use '~@proton/styles/scss/lib/config' as *;
@use '~@proton/styles/scss/lib/rem' as *;
@use '~@proton/styles/scss/lib/include-media' as im;

im.$breakpoints: $breakpoints-product;
im.$media-expressions: $media-expressions;

.main-text-container {
	container-type: inline-size;
	container-name: maintext;
	max-inline-size: 100%;

	@include im.media('<=small') {
		inline-size: 100%;
		max-inline-size: 100%;
		box-sizing: border-box;
	}
}

.main-text {
	font-family: Syne, Inter, system-ui, sans-serif;
	font-size: rem(36);
	font-feature-settings: 'ss04';

	@include im.media('<=medium') {
		font-size: rem(30);
	}

	@container maintext (width < 16rem) {
		font-size: rem(24);
	}

	&.small {
		font-size: rem(22);
	}
}

.lumo-welcome-section {
	transition: opacity 0.3s ease-out;

	&.is-hidden {
		opacity: 0;
		pointer-events: none;
	}

	&.is-visible {
		opacity: 1;
		pointer-events: auto;
	}
}

.lumo-gradient-text {
	font-family: Syne, Inter, system-ui, sans-serif;
	color: #8b7cf6; /* Fallback color */
	background: linear-gradient(135deg, #ffac2e 15.77%, #dd5dcc 38.4%, #1ba3fd 75.93%, #5325a2 99.84%);
	background-clip: text;
	-webkit-text-fill-color: transparent;
}

.sidebar {
	background-color: inherit;

	// Smooth width transitions for desktop
	transition:
		inline-size 0.3s ease-in-out,
		transform 0.3s ease-in-out;

	// Hardware acceleration
	will-change: inline-size, transform;
	backface-visibility: hidden;

	// Only apply translateZ on desktop to avoid conflicts with mobile translateX
	@include im.media('>small') {
		transform: translateZ(0);
	}

	&--collapsed {
		inline-size: 64px; // Collapsed width - fits icons + padding
	}

	&:not(.sidebar--collapsed) {
		inline-size: 300px; // Expanded width - comfortable for text
	}

	// Mobile sidebar transitions - true overlay that doesn't affect layout
	@include im.media('<=small') {
		position: fixed !important;
		inset-block-start: 0 !important;
		inset-inline-start: 0 !important;
		block-size: 100% !important;
		z-index: 100 !important;
		inline-size: 100% !important;

		// Force transitions to work even with immediate class changes
		transition: transform 0.3s ease-in-out !important;
		will-change: transform !important;

		// Mobile hidden state - completely off-screen (default state)
		transform: translateX(-100%) !important;

		// Mobile overlay state - slide into view as overlay
		&.sidebar-expanded {
			transform: translateX(0) !important;
		}

		// Ensure transition works both ways
		&:not(.sidebar-expanded) {
			transform: translateX(-100%) !important;
		}

		// Ensure sidebar doesn't affect main content layout
		margin: 0 !important;
		padding: 0 !important;

		// Remove any width that might affect layout calculations
		flex: none !important;
		flex-basis: auto !important;
	}
}

.sidebar-expanded {
	background-color: var(--background-weak);

	// Safari performance optimizations for expanded state
	will-change: transform;
	backface-visibility: hidden;
	transform: translateZ(0);

	.lumo-guest-disclaimer {
		background-color: var(--background-weak);
	}
}

// Sidebar backdrop - base properties (mobile enhancements in LumoSidebar.scss)
.sidebar-backdrop {
	position: fixed;
	inset-block-start: 0;
	inset-inline-start: 0;
	inline-size: 100vw;
	block-size: 100%; // Use percentage instead of viewport units for Safari compatibility
	opacity: 1;
	pointer-events: auto;
	z-index: 90; // Behind sidebar (which is z-index: 100) but above content

	// Use hardware acceleration for backdrop
	will-change: opacity;
	backface-visibility: hidden;
	transform: translateZ(0);

	// Smooth backdrop transitions
	transition:
		opacity 0.3s ease-in-out,
		backdrop-filter 0.3s ease-in-out;
}

// Smooth content transitions in sidebar
.sidebar-content {
	// Use hardware acceleration for content transitions
	will-change: opacity;
	backface-visibility: hidden;
	transform: translateZ(0);

	// Prevent layout thrashing during transitions
	contain: layout style paint;

	// Smooth content fade-in
	transition: opacity 0.15s ease-in-out;

	&.is-loading {
		opacity: 0.9;
	}

	&.is-loaded {
		opacity: 1;
	}
}

.navigation-link.is-active {
	color: var(--text-norm) !important;

	&.navigation-link {
		font-weight: 600 !important;
		border-radius: 8px;
	}
}

.navigation > .navigation-list:last-child,
.navigation > div > .navigation-list:last-child {
	padding-block-end: 0;
}

.header-lumo {
	block-size: rem(60);

	button {
		img {
			block-size: 30px;
		}
	}
}

.user-dropdown-text:not(.homepage-wrapper *, .mobile-user-dropdown *) {
	display: none;
}

.user-dropdown-button {
	flex-shrink: 0;

	.user-initials {
		font-size: rem(12);
	}

	.rounded {
		border-radius: var(--border-radius-md);
	}
}

.chat-container {
	border-image: linear-gradient(134.93deg, rgb(226 219 255 / 0.3) -0.55%, rgb(226 219 255 / 0) 29.89%);
	border-image-slice: 1;
	border-radius: 1rem;
	background-color: #ffffff0d;
}

.circle-chart-circle {
	stroke: var(--primary);
}

.composer {
	outline: none;
	border: none;
}

.composer:focus {
	outline: none;
	border: none;
}

.input-element:focus {
	outline: none;
}

.ProseMirror {
	will-change: contents;
	contain: layout;
	backface-visibility: hidden;

	@include im.media('<=small') {
		font-size: 16px;
	}
}

.ProseMirror:focus {
	outline: none;
	border: none;
}

.tiptap p {
	margin-block: 0;
	font-size: 16px !important;
}

.tiptap p.is-editor-empty:first-child::before {
	// placeholder text
	color: var(--text-weak);
	content: attr(data-placeholder);
	float: inline-start;
	block-size: 0;
	pointer-events: none;
}

.action-toolbar {
	opacity: 0.8;
}

.timeline-unpinned {
	background-color: #c5b7ff26;
}

.timeline-bar {
	background-color: var(--border-norm);
}

.message-chain .assistant-msg:last-child {
	margin-block-end: 0;
}

/*
 * Hide a div injected by the Proton framework.
 */

#icons-root {
	display: none;
}

.link-over-btn {
	&:hover {
		color: var(--primary-hover);
	}

	cursor: pointer;
}

@media print {
	.lumo-avatar {
		position: static;
	}

	.user-msg-container {
		display: block;
		page-break-inside: auto;
	}

	main {
		margin: 1em;
	}

	.assistant-msg,
	.user-msg {
		margin-block-end: 1em;
		page-break-inside: auto;
	}
}

@media print {
	.no-print {
		display: none !important;
	}
}

.prompt {
	&#{&} {
		--size: #{rem(320)};
	}
}

// Override subscription modal sizing in lumo to ensure correct width
// This compensates for CSS loading order issues caused by --prependAsyncCss
.subscription-modal--medium-width {
	--size: #{rem(900)} !important;
	--margin: #{rem(24)} !important;
}

.subscription-modal--large-width {
	--size: #{rem(1200)} !important;
	--margin: #{rem(32)} !important;
}

@media screen and (width <= 600px) {
	.border-top {
		border-block-start: none !important;
	}
}

.dropdown {
	--selection-background-color: var(--interaction-default-hover);
	--selection-text-color: var(--interaction-weak-contrast);
}

.new-label {
	background-color: #8080ff;
	color: white;
}

.no-border {
	border: none !important;
}
