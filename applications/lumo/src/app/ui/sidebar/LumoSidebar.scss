@use '~@proton/styles/scss/lib/config' as *;
@use '~@proton/styles/scss/lib/include-media' as im;
im.$breakpoints: $breakpoints-product;
im.$media-expressions: $media-expressions;

.lumo-sidebar {
	display: flex;
	flex-direction: column;
	block-size: 100%;
	padding: 12px;
	gap: 8px;

	@include im.media('<=small') {
		background-color: var(--background-composer-mobile);
	}

	// Remove list styling from Lumo Plus button
	li {
		list-style: none !important;
		margin-inline-start: 0 !important;
		padding-inline-start: 0 !important;
	}

	// Ensure Lumo Plus button matches other items
	.navigation-item {
		list-style: none !important;
		margin: 0 !important;
		padding: 0 !important;

		.navigation-link,
		button {
			@extend .sidebar-item;

			border-radius: 8px !important;
			block-size: 40px !important;
			display: flex !important;
			align-items: center !important;
			padding: 8px !important;
			padding-inline: 6px !important;

			&:hover {
				background-color: var(--interaction-default-hover) !important;
			}
		}
	}
}

.sidebar-section {
	display: flex;
	flex-direction: column;
	gap: 4px;

	&.sidebar-bottom {
		margin-block-start: auto;
		padding-block-start: 12px;
	}
}

.search-container {
	display: flex;
	align-items: center;
	inline-size: 100%;
	block-size: 40px;
	padding: 8px;
	border-radius: 8px;
	cursor: pointer;
	padding-inline: 6px;
	transition:
		background-color 0.3s ease,
		border 0.3s ease,
		border-color 0.3s ease;
	overflow: visible; // Allow shortcut to be visible

	// Always maintain input field styling initially
	background-color: var(--background-weak);
	border: 1px solid var(--border-weak);

	// Collapsed state - gradually fade background and border
	&.collapsed {
		// Delay the background fade to allow smooth transition
		transition-delay: 0.1s;
		background-color: transparent;
		border-color: transparent;
		cursor: pointer;

		&:hover {
			background-color: var(--background-weak);
			border-color: transparent;
			transition-delay: 0s; // Remove delay on hover for immediate feedback
		}
	}

	// Expanded state - full input field styling
	&:not(.collapsed) {
		background-color: var(--background-weak);
		border-color: var(--border-weak);
		cursor: text;
		transition-delay: 0s; // No delay when expanding

		&:focus-within {
			border-color: var(--focus-outline);
		}

		&:hover {
			border-color: var(--border-norm);
		}
	}

	// Icon stays in fixed position
	.sidebar-item-icon {
		// Same positioning as other sidebar items
		inline-size: 24px;
		block-size: 24px;
		margin-inline-end: 12px;
		flex-shrink: 0;
	}
}

.search-input-wrapper {
	flex: 1;
	display: flex;
	align-items: center;
	gap: 8px;
	opacity: 1;
	transition: opacity 0.3s ease; // Smooth fade transition
	min-inline-size: 0; // Allow flex item to shrink

	&.hidden {
		opacity: 0;
		pointer-events: none;
	}
}

.search-shortcut {
	flex-shrink: 0;
	margin-inline-start: auto;
	opacity: 0.6;

	.kbd {
		font-size: 11px;
		padding-block: 2px;
		padding-inline: 4px;
	}
}

.sidebar-search-input {
	flex: 1;
	min-inline-size: 0;
	border: none;
	margin-inline-start: -7px;
	background: transparent;
	outline: none;
	font-size: 14px;
	color: var(--text-norm);

	&::placeholder {
		color: var(--text-weak);
		transition: opacity 0.6s ease; // Smooth transition for rotating text
	}

	&[readonly] {
		pointer-events: none;
	}

	&:disabled {
		color: var(--text-weak);
		cursor: not-allowed;

		&::placeholder {
			color: var(--text-hint);
		}
	}
}

.search-label {
	flex: 1;
	font-size: 14px;
	color: var(--text-norm);
	opacity: 1;
	transition: opacity 0.3s ease;

	&.hidden {
		// Smoothly fade out label during sidebar expansion
		opacity: 0;
		pointer-events: none;
	}
}

// Favorites content - only specific styling needed
.favorites-content {
	max-block-size: 30vh;
	overflow-y: auto;
}

// Chat history sidebar section - structured like projects
.chat-history-sidebar-section {
	display: flex;
	flex-direction: column;
	flex: 1;
	min-block-size: 0;
	overflow: hidden;
}

// Chat history content area
.chat-history-content {
	flex: 1;
	min-block-size: 0;
	margin-block: 0;
	margin-inline: 0;
	opacity: 0;
	transition: opacity 0.3s ease-in-out;
	position: relative;
	overflow: hidden; // Prevent content from expanding beyond boundaries

	// Ensure smooth transitions without affecting layout
	pointer-events: auto;

	// When content should be visible (shouldShowContent is true)
	&.content-visible {
		opacity: 1;
	}

	// When content should be hidden (shouldShowContent is false)
	&:not(.content-visible) {
		opacity: 0;
		pointer-events: none;
	}

	// Additional opacity control for text visibility during sidebar transitions
	&.content-visible:not(.text-visible) {
		opacity: 0.3; // Partially visible during sidebar collapse/expand
	}
}

// Prevent text reflow during sidebar transitions by maintaining fixed layout
// Target the ChatHistory container to prevent responsive width changes
.chat-history-content .chat-history-container {
	position: absolute;
	inset-block-start: 0;
	inset-inline-start: 0;
	block-size: 100%;
	inline-size: 100%;
	max-inline-size: 100%;
	min-inline-size: 235px;

	// Enable scrolling for content overflow
	overflow: hidden auto;

	// Hardware acceleration for smooth transitions
	transform: translateZ(0);
}

// Base sidebar item styling
.sidebar-item {
	display: flex;
	align-items: center;
	inline-size: 100%;
	block-size: 40px;
	padding: 8px;
	border: none;
	background: transparent;
	border-radius: 8px;
	cursor: pointer;
	text-decoration: none;
	color: inherit;
	font-size: 14px;
	transition: background-color 0.15s ease;
	padding-inline: 6px;

	&:hover {
		background-color: var(--background-weak);
	}

	&:focus {
		outline: 2px solid var(--focus-outline);
		outline-offset: -2px;
	}
}

.sidebar-item-icon {
	display: flex;
	align-items: center;
	justify-content: center;
	inline-size: 24px;
	block-size: 24px;
	flex-shrink: 0;
	margin-inline-end: 6px;
}

.sidebar-item-text {
	flex: 1;
	display: flex;
	align-items: center;
	justify-content: space-between;
	text-align: start;
	white-space: nowrap;
	overflow: hidden;
	opacity: 1;
	transition: opacity 0.3s ease;
	gap: 8px;
	min-inline-size: 0; // Allow flex item to shrink below content size

	// Note: not sure what this is for, commenting out for now
	// // Text content that can truncate
	// > :first-child {
	// 	overflow: hidden;
	// 	text-overflow: ellipsis;
	// 	white-space: nowrap;
	// 	flex: 1;
	// 	min-inline-size: 0;
	// }

	&.hidden {
		opacity: 0;
		pointer-events: none;
	}
}

.sidebar-item-shortcut {
	flex-shrink: 0;
	margin-inline-start: auto;
	opacity: 0.6;
	transition: opacity 0.15s ease;

	.kbd {
		font-size: 11px;
		padding-block: 2px;
		padding-inline: 4px;
		display: inline-block;
	}
}

// Hide shortcut by default, show on hover for items with showShortcutOnHover class
.sidebar-item.show-shortcut-on-hover {
	.sidebar-item-shortcut {
		opacity: 0;
		pointer-events: none;
	}

	&:hover .sidebar-item-shortcut {
		opacity: 0.6;
		pointer-events: auto;
	}
}

.sidebar-section-header {
	display: flex;
	align-items: center;
	block-size: 32px;
	padding-block: 4px;
	padding-inline: 8px;
	margin-block: 8px 4px;

	svg,
	.icon {
		inline-size: 16px;
		block-size: 16px;
		margin-inline-end: 8px;
		flex-shrink: 0;
		opacity: 0.7;
	}

	span {
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}
}

.sidebar-section-header-collapsed {
	display: flex;
	align-items: center;
	justify-content: center;
	block-size: 40px;
	padding: 8px;
	margin-block: 4px;
	cursor: pointer;
	border-radius: 8px;
	transition: background-color 0.15s ease;

	&:hover {
		background-color: var(--background-weak);
	}

	svg,
	.icon {
		inline-size: 20px;
		block-size: 20px;
		opacity: 0.7;
	}
}

// Desktop sidebar z-index to ensure it's above disclaimers and other content
.sidebar {
	z-index: 10; // Higher than disclaimer (z-1) but lower than mobile overlay (z-100)
	position: relative;
}

.sidebar button:hover,
.sidebar .navigation-link:hover {
	border-radius: 8px;
}

.sidebar-list-item-content {
	.shrink-0 {
		min-inline-size: 1rem;
		inline-size: 1rem;
		display: flex;
		align-items: center;
		justify-content: center;
		will-change: transform;
		backface-visibility: hidden;
		transform: translateZ(0);
	}

	.text-ellipsis {
		transition: opacity 0.15s ease-in-out;
		will-change: opacity;
	}
}

.projects-list {
	margin-inline-start: 23px;
}

.projects-text-div {
	flex: 1;
	text-align: start;
	transition: background-color 0.15s ease;

	&:focus {
		outline: 2px solid var(--focus-outline);
		outline-offset: -2px;
	}

	&:hover {
		background-color: transparent !important;
	}
}

.projects-create-button {
	border-radius: 4px;
	opacity: 0.6;
	transition:
		opacity 0.15s ease,
		background-color 0.15s ease;
	block-size: 22px;
	inline-size: 21px;
	padding-block-end: 2px;

	&:hover {
		opacity: 0.6;
		background-color: #e7e7e7;
	}
}

// Mobile-specific sidebar enhancements (core positioning handled in index.scss)
@include im.media('<=small') {
	// Reset sidebar bottom padding on mobile
	.sidebar-section.sidebar-bottom {
		padding-block-start: 0;
	}

	// Mobile sidebar styling - white background and elegant drop shadow
	.sidebar {
		// White background for clean mobile appearance
		background-color: var(--background-norm) !important;

		// Ensure sidebar is above backdrop and clickable
		z-index: 100 !important;
		position: relative !important; // Ensure z-index works

		// Elegant drop shadow for mobile overlay
		box-shadow:
			2px 0 8px rgb(0 0 0 / 0.02),
			0 0 20px rgb(0 0 0 / 0.04);

		// Hide shadow when sidebar is hidden - but with transition
		&:not(.sidebar-expanded) {
			box-shadow: none;
			transition-delay: 0s; // Remove shadow immediately when hiding
		}

		// When expanded, show shadow with slight delay
		&.sidebar-expanded {
			transition-delay: 0.1s; // Small delay for shadow to appear
		}
	}

	// Subtle white overlay for mobile - elegant and minimal
	.sidebar-backdrop {
		position: fixed;
		inset-block-start: 0;
		inset-inline-start: 0;
		inline-size: 100vw;
		block-size: 100%; // Use percentage instead of viewport units for Safari compatibility
		opacity: 1 !important;
		pointer-events: auto !important;
		z-index: 90 !important; // Behind sidebar (which is z-index: 100) but above content
		transition: opacity 0.3s ease-in-out;

		// backdrop-filter: blur(5px) !important; // Blur removed - was making content blurry
	}

	.lumo-sidebar {
		padding: 16px;

		// Ensure smooth mobile transitions
		transition: transform 0.3s ease-in-out;
		will-change: transform;

		// Ensure sidebar content is clickable
		position: relative;
		z-index: 101; // Higher than sidebar container
		pointer-events: auto;

		// New chat and search sections are now conditionally rendered for mobile guests
	}

	.projects-header-container {
		position: relative;
		border-radius: 8px;

		&:hover {
			background-color: var(--background-weak);
			transition: 0.3s all;
		}
	}

	.projects-header-button {
		position: relative;
		flex: 1;
	}

	.projects-icon-button {
		border-radius: 6px;
		flex-shrink: 0;
		min-inline-size: 24px;
		block-size: 24px;
	}

	.project-sidebar-item {
		padding-block: 6px;
		padding-inline: 12px;
		border-radius: 6px;
		text-decoration: none;
		color: var(--text-norm);
		transition: background-color 0.15s ease;
		min-block-size: 32px;

		&.is-active {
			background-color: var(--interaction-default-hover);
			font-weight: 500;
		}
	}

	.project-sidebar-item-see-all {
		padding-block: 4px;
		padding-inline: 12px;
		border-radius: 4px;
	}

	.projects-empty {
		color: var(--text-weak);
		margin-inline-start: 36px;
	}

	.sidebar-bottom-user-dropdown {
		padding-block: 8px;
		padding-inline: 16px;
		margin-block: 0 -16px;
		margin-inline: -16px;
		border-block-start: 1px solid var(--border-weak);

		button {
			border: none;
		}
	}

	// Larger touch targets and spacing for mobile sidebar items
	.sidebar-item {
		block-size: 44px;
	}
}

.bg-white {
	background-color: white !important;
}
