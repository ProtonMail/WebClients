@use '~@proton/styles/scss/lib' as *;

.thinking-path {
    margin-block: 0.75rem;
}

.thinking-step {
    position: relative;
    display: flex;
    inline-size: 100%;
    padding-inline-start: 2.5rem;
    padding-block: 0.5rem;
    min-block-size: 2.5rem;

    &::before {
        content: '';
        position: absolute;
        inset-inline-start: 0.75rem;
        inset-block-start: 2rem;
        inset-block-end: 0;
        inline-size: 1px;
        background-color: var(--border-norm);
    }

    &::after {
        content: '';
        position: absolute;
        inset-inline-start: 0.75rem;
        inset-block-start: 0;
        block-size: 1rem;
        inline-size: 1px;
        background-color: var(--border-norm);
    }

    &--first::after {
        opacity: 0;
    }

    &--last::before {
        opacity: 0;
    }
}

.thinking-step-icon-container {
    position: absolute;
    inset-inline-start: 0.406rem;
    inset-block-start: 0.75rem;
}

.thinking-step-icon-badge {
    color: var(--text-weak);

    &--active {
        color: var(--interaction-norm);
        animation: gentlePulse 1.5s ease-in-out infinite;
    }

    &--error {
        background-color: var(--signal-danger);
        color: var(--signal-danger-contrast);
    }
}

.thinking-step-content {
    flex: 1;
    min-inline-size: 0;
    padding-block-start: 0.25rem;
}

.thinking-step-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    inline-size: 100%;
    padding-block: 0.25rem;
    padding-inline: 0.5rem;
    margin-block: -0.25rem;
    margin-inline: -0.5rem;
    background: transparent;
    border: none;
    cursor: pointer;
    border-radius: 0.375rem;
    transition: background-color 0.15s ease;
    color: var(--text-weak);
    font-size: 0.875rem;
    text-align: start;

    &:hover {
        background-color: var(--background-weak);
    }

    &:focus-visible {
        outline: 2px solid var(--focus-outline);
        outline-offset: 2px;
    }
}

.thinking-step-chevron {
    flex-shrink: 0;
    transition: transform 0.2s ease;
    color: var(--text-weak);

    &--expanded {
        transform: rotate(180deg);
    }
}

.thinking-step-label {
    flex: 1;
    font-size: 0.875rem;
    padding-block-start: 0.125rem;
}

.thinking-step-details {
    margin-block-start: 0.5rem;
    padding: 0.2rem;
    font-size: 0.75rem;
    color: var(--text-weak);
    animation: fadeIn 0.2s ease-out;

    :global {
        .prose {
            font-size: 0.875rem;
            max-inline-size: none;
        }

        p {
            margin-block-end: 0.75rem;

            &:last-child {
                margin-block-end: 0;
            }
        }

        pre {
            margin-block-end: 0.75rem;

            &:last-child {
                margin-block-end: 0;
            }
        }

        ul,
        ol {
            margin-block-end: 0.75rem;
            padding-inline-start: 1.5rem;
        }

        li {
            margin-block-end: 0.25rem;
        }

        code {
            font-size: 0.85em;
        }
    }
}

@keyframes gentlePulse {
    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.6;
        transform: scale(1.1);
    }
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-0.25rem);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
