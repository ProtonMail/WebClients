import { EditorHtmlExporter } from './EditorHtmlExporter'
import type { ExporterRequiredCallbacks } from './EditorExporter'
import { uint8ArrayToUtf8String } from '@proton/crypto/lib/utils'

describe('EditorHtmlExporter', () => {
  it('should export plaintext from editor', async () => {
    const stringifiedEditorState = `{"root":{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Heading 1","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"heading","version":1,"tag":"h1"},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Heading 2","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"heading","version":1,"tag":"h2"},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Bold","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" ","type":"text","version":1},{"detail":0,"format":2,"mode":"normal","style":"","text":"italic","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" ","type":"text","version":1},{"detail":0,"format":8,"mode":"normal","style":"","text":"underline","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" ","type":"text","version":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"link","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"link","version":1,"rel":"noreferrer","target":null,"title":null,"url":"https://test.com"},{"detail":0,"format":0,"mode":"normal","style":"","text":" ","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"color: rgb(109, 74, 255);","text":"color","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" ","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"background-color: rgba(109, 74, 255, 0.15);","text":"background","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Numbered","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"list","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":2}],"direction":"ltr","format":"","indent":0,"type":"list","version":1,"listType":"number","start":1,"tag":"ol"},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Bulleted","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"list","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":2}],"direction":"ltr","format":"","indent":0,"type":"list","version":1,"listType":"bullet","start":1,"tag":"ul"},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Check","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"checked":false,"value":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"list","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"checked":false,"value":2}],"direction":"ltr","format":"","indent":0,"type":"list","version":1,"listType":"check","start":1,"tag":"ul"},{"children":[{"children":[{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Basic","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":3,"rowSpan":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"table","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":1,"rowSpan":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"with","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":1,"rowSpan":1}],"direction":null,"format":"","indent":0,"type":"tablerow","version":1},{"children":[{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"three","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":2,"rowSpan":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"columns","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":0,"rowSpan":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"and","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":0,"rowSpan":1}],"direction":null,"format":"","indent":0,"type":"tablerow","version":1},{"children":[{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"content","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":2,"rowSpan":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"in","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":0,"rowSpan":1},{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"each","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":null,"format":"","indent":0,"type":"tablecell","version":1,"backgroundColor":null,"colSpan":1,"headerState":0,"rowSpan":1}],"direction":null,"format":"","indent":0,"type":"tablerow","version":1}],"direction":null,"format":"","indent":0,"type":"table","version":1},{"children":[],"direction":null,"format":"","indent":0,"type":"paragraph","version":1,"textFormat":0}],"direction":"ltr","format":"","indent":0,"type":"root","version":1}}`

    const exporter = new EditorHtmlExporter(stringifiedEditorState, {} as ExporterRequiredCallbacks)

    const result = await exporter.export()

    expect(uint8ArrayToUtf8String(result)).toBe(
      `<h1 dir="ltr"><span style="white-space: pre-wrap;">Heading 1</span></h1><h2 dir="ltr"><span style="white-space: pre-wrap;">Heading 2</span></h2><p dir="ltr"><b><strong style="white-space: pre-wrap;">Bold</strong></b><span style="white-space: pre-wrap;"> </span><i><em style="white-space: pre-wrap;">italic</em></i><span style="white-space: pre-wrap;"> </span><u><span style="white-space: pre-wrap;">underline</span></u><span style="white-space: pre-wrap;"> </span><a href="https://test.com" rel="noreferrer" dir="ltr"><span style="white-space: pre-wrap;">link</span></a><span style="white-space: pre-wrap;"> </span><span style="color: rgb(109, 74, 255); white-space: pre-wrap;">color</span><span style="white-space: pre-wrap;"> </span><span style="background-color: rgba(109, 74, 255, 0.15); white-space: pre-wrap;">background</span></p><ol><li value="1" dir="ltr"><span style="white-space: pre-wrap;">Numbered</span></li><li value="2" dir="ltr"><span style="white-space: pre-wrap;">list</span></li></ol><ul><li value="1" dir="ltr"><span style="white-space: pre-wrap;">Bulleted</span></li><li value="2" dir="ltr"><span style="white-space: pre-wrap;">list</span></li></ul><ul __lexicallisttype="check"><li role="checkbox" tabindex="-1" aria-checked="false" value="1" dir="ltr"><span style="white-space: pre-wrap;">Check</span></li><li role="checkbox" tabindex="-1" aria-checked="false" value="2" dir="ltr"><span style="white-space: pre-wrap;">list</span></li></ul><table><colgroup><col><col><col></colgroup><tbody><tr><th style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start; background-color: rgb(242, 243, 245);"><p dir="ltr"><span style="white-space: pre-wrap;">Basic</span></p></th><th style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start; background-color: rgb(242, 243, 245);"><p dir="ltr"><span style="white-space: pre-wrap;">table</span></p></th><th style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start; background-color: rgb(242, 243, 245);"><p dir="ltr"><span style="white-space: pre-wrap;">with</span></p></th></tr><tr><th style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start; background-color: rgb(242, 243, 245);"><p dir="ltr"><span style="white-space: pre-wrap;">three</span></p></th><td style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start;"><p dir="ltr"><span style="white-space: pre-wrap;">columns</span></p></td><td style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start;"><p dir="ltr"><span style="white-space: pre-wrap;">and</span></p></td></tr><tr><th style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start; background-color: rgb(242, 243, 245);"><p dir="ltr"><span style="white-space: pre-wrap;">content</span></p></th><td style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start;"><p dir="ltr"><span style="white-space: pre-wrap;">in</span></p></td><td style="border: 1px solid black; width: 75px; vertical-align: top; text-align: start;"><p dir="ltr"><span style="white-space: pre-wrap;">each</span></p></td></tr></tbody></table><p><br></p>`,
    )
  })
})
